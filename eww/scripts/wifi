#!/usr/bin/bash
choice="$1"
wifi_status=$(nmcli radio wifi)

wifi_on() {
    nmcli radio wifi on
}

wifi_off(){
    nmcli radio wifi off
}

wifi_info() {
    connected=$(nmcli -t -f STATE connection show --active | sed 1d | grep -c "activated")
    if [ "$connected" -eq 0 ]; then
        wifi_status="disconnected"
    else
        wifi_status="connected"
    fi

    json="{\"status\":\"$wifi_status\",\"name\":\"$(wifi_name)\",\"icon\":\"$(wifi_icon)\"}"
    echo $json
}

wifi_name() {
    wifi_name=$(nmcli connection show --active | grep wifi | awk '{print $1}')
    if [ -z "$wifi_name" ]; then
        echo "Wi-Fi"
    else
        echo "$wifi_name"
    fi
}

wifi_icon() {
    connected=$(nmcli -t -f STATE connection show --active | sed 1d | grep -c "activated")
    signal=$(nmcli -t -f IN-USE,SIGNAL device wifi | grep '*' | cut -d':' -f2)

    if [ "$connected" -eq 0 ]; then
        icon="󰤮"
    elif [ "$signal" -ge -50 ]; then
        icon="󰤨"
    elif [ "$signal" -ge -60 ]; then
        icon="󰤥"
    elif [ "$signal" -ge -70 ]; then
        icon="󰤢"
    elif [ "$signal" -ge -80 ]; then
        icon="󰤟"
    else
        icon="󰤯"
    fi
    echo $icon
}

if [[ $choice == "--on" ]]; then
    wifi_on
elif [[ $choice == "--off" ]]; then
    wifi_off
elif [[ $choice == "--info" ]]; then
    wifi_info
fi